<div>
    <confirm-dialog></confirm-dialog>
    <button type="button" class="btn btn-outline-primary" (click)="newDataSetFormIsCollapsed = !newDataSetFormIsCollapsed">Add New DataSet</button>
    <br/>
    <div class="well collapse col-sm-6" [ngbCollapse]="newDataSetFormIsCollapsed">
        <form #f="ngForm" (ngSubmit)="save()" class="form-horizontal">
            <div class="form-group">
                <label for="name" class="col-sm-2 control-label">Name</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" [(ngModel)]="newDataSet.dataSet.Name" name="name" required>
                </div>
            </div>
            <div *ngIf="newDataSet.IsNew">
                <div class="form-group">
                    <label for="nGramCount" class="col-sm-2 control-label">NGram Count</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" [(ngModel)]="newDataSet.dataSet.NGramCount" name="nGramCount" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="idField" class="col-sm-2 control-label">Id Field</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" [(ngModel)]="newDataSet.dataSet.IdField" name="idField" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="tagField" class="col-sm-2 control-label">Tag Field</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" [(ngModel)]="newDataSet.dataSet.TagField" name="tagField" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="interpretedFields" class="col-sm-2 control-label">Interpreted Fields</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" [(ngModel)]="newDataSet.dataSet.InterpretedFields" name="interpretedFields" required>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-offset-2 col-sm-10">
                        <div class="checkbox">
                            <label>
                                    <input type="checkbox" [(ngModel)]="newDataSet.sampleDocumentChecked" name="sampleOrSchema">Use Sample Document
                                </label>
                        </div>
                    </div>
                </div>
                <div class="form-group" [ngbCollapse]="!newDataSet.sampleDocumentChecked">
                    <label for="sample" class="col-sm-2 control-label">Sample Document</label>
                    <div class="col-sm-10">
                        <textarea class="form-control" [(ngModel)]="newDataSet.dataSet.SampleDocument" name="sample" class="col-sm-12 sample-json"></textarea>
                    </div>
                </div>
                <div class="form-group" [ngbCollapse]="newDataSet.sampleDocumentChecked" [hidden]="!newDataSet.IsNew">
                    <label for="schema" class="col-sm-2 control-label">Schema</label>
                    <div class="col-sm-10">
                        <textarea class="form-control" [(ngModel)]="newDataSet.dataSet.Schema" name="schema" class="col-sm-12 sample-json"></textarea>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10">
                    <button class="btn btn-default" type="submit" [disabled]="!f.valid">Save</button>
                </div>
            </div>
        </form>
    </div>
    <br/>
    <div *ngIf="dataSets && dataSets.length">
        <table class="table table-striped table-hover" contextmenu="contextmenu">
            <thead>
                <tr>
                    <th></th>
                    <th>Name</th>
                    <th>Id Field</th>
                    <th>Tag Field</th>
                    <th>Interpreted Fields</th>
                    <th>Document Count</th>
                    <th>NGram Count</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody *vsFor="dataSets; tagName:'tr'; scrollParent:'div'; excess: 2; autoresize:true; let _items = vsCollection; let _startIndex = vsStartIndex">
                <tr *ngFor="let dataSet of _items; let i= index" (click)="select(dataSet)" (dblclick)="gotoDocuments(dataSet)" [class.selected-row]="dataSet==selectedDataSet">
                    <td>{{ i + _startIndex + 1}}</td>
                    <td>{{ dataSet.Name }}</td>
                    <td>{{ dataSet.IdField }}</td>
                    <td>{{ dataSet.TagField }}</td>
                    <td>{{ dataSet.InterpretedFields.join(", ") }}</td>
                    <td>{{ dataSet.Statistics?.DocumentsCount }}</td>
                    <td>{{ dataSet.NGramCount }}</td>
                    <td>
                        <button md-icon-button [md-menu-trigger-for]="menu">
                            <md-icon>more_vert</md-icon>
                        </button>
                        <md-menu #menu="mdMenu" x-position="before">
                            <button md-menu-item (click)="gotoDocuments(dataSet)">Open</button>
                            <button md-menu-item (click)="cloneDataSet(dataSet)">Clone</button>
                            <button md-menu-item (click)="renameDataSet(dataSet)">Rename</button>
                            <button md-menu-item (click)="deleteConfirm(dataSet)">Delete</button>
                        </md-menu>
                    </td>
                </tr>
            </tbody>
        </table>
        <div *ngIf="selectedDataSet?.SampleDocument" class="label label-info">Sample Document</div>
        <div *ngIf="selectedDataSet?.Scheme" class="label label-default">Scheme</div>
        <textarea *ngIf="selectedDataSet" class="col-sm-12 sample-json" readonly>{{selectedDataSetJson()}}</textarea>
    </div>
</div>