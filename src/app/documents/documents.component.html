<div>
	<CommonTemplates></CommonTemplates>
	<dataset-selector></dataset-selector>
	<tag-selector></tag-selector>
	<document-details-dialog></document-details-dialog>
	<input-dialog></input-dialog>
	<confirm-dialog></confirm-dialog>
	<div class='panel-body'>
		<div class='has-error' *ngIf='errorMessage'>{{errorMessage}}</div>
		<div>
			<ngb-tabset>
				<ngb-tab title="Documents">
					<template ngbTabContent>
						<!--add or edit document section-->
						<div>
							<br/>
							<button type="button" class="btn  btn-outline-primary" (click)="collapsePendingDocument()">Add New Document</button>
							<br/>
							<br/>
							<form #fd="ngForm" [ngbCollapse]="newDocumentFormIsCollapsed" (ngSubmit)="saveDocument()" class="collapse">
								<p>
									<textarea [(ngModel)]="pendingDocument.Document" name="document" cols="200" rows="10" style="{min-height: 300px; min-width: 400px;}"></textarea>
								</p>
								<p>
									<button class="btn" type="submit" [disabled]="!fd.valid">Save</button>
								</p>
							</form>
							<br/>
						</div>
						<hr role="separator" class="divider">
						<div class="container-fluid">
							<div class="row">
								<!--field filter section-->
								<div class="col-md-3">
									<div class="card" style="display: inline;">
										<div class="card-header">
											<span class="h3">
                                        Fields
                                    </span>
										</div>
										<br role="separator" class="divider">
										<div class="card-block">
											<div class="table-responsive" style="overflow-y: auto; overflow-x: auto; max-height: 300px">
												<table class='table table-striped'>
													<thead>
														<th><input type="checkbox" [checked]="getSelectedItemsCount(fields) == fields.length" name="checkAll" (change)="checkField($event)"
																style="margin: 3px;"></th>
														<th>Field</th>
													</thead>
													<tbody>
														<tr *ngFor='let field of fields'>
															<td><input type="checkbox" [checked]="field.IsSelected" name="check" (change)="checkField($event, field)"></td>
															<td>{{field.Name}}</td>
														</tr>
													</tbody>
												</table>
											</div>
											<button class="btn btn-default" (click)="fieldFilter()">Set Fields</button>
										</div>
									</div>
								</div>
								<div class="col-md-1 divider" role="separator">
								</div>
								<!--filter section-->
								<div class="col-md-3">
									<div class="card" style="display: inline;">
										<div class="card-header">
											<span class="h3">
                                        Filter
                                    </span>
										</div>
										<br role="separator" class="divider">
										<div class="card-block">
											<form (submit)="filter()">
												<div class="form-group">
													<button type="button" class="btn  btn-outline-primary" (click)="filterTagsIsCollapsed = !filterTagsIsCollapsed">Select tags</button>
													<br role="separator" class="divider">
													<br>
													<div class="table-responsive" style="overflow-y: auto; overflow-x: auto; max-height: 300px">
														<table class='table table-striped collapse' [ngbCollapse]="filterTagsIsCollapsed">
															<thead>
																<th><input type="checkbox" [checked]="getSelectedItemsCount(tagsForFilter) == tagsForFilter.length" name="checkAll"
																		(change)="checkFilterTag($event)" style="margin: 3px;"></th>
																<th>Name</th>
																<th>Id</th>
															</thead>
															<tbody *vsFor="tagsForFilter; tagName:'tr'; scrollParent:'div'; excess: 2; autoresize:true; let _items = vsCollection">
																<tr *ngFor='let tag of _items'>
																	<td><input type="checkbox" [checked]="tag.IsSelected" name="check" (change)="checkFilterTag($event, tag)"></td>
																	<!--<td><input type="checkbox" [(checked)]="tag.IsSelected"></td>-->
																	<td>{{tag.Name}}</td>
																	<td>{{tag.Id}}</td>
																</tr>
															</tbody>
														</table>
													</div>
													<p>{{ getSelectedItems(tagsForFilter) }} item(s) selected
													</p>
												</div>
												<div class="form-group">
													<label>Query </label>
													<input type="text" class="form-control" name="query" [(ngModel)]="filterSettings.Filter.Query">
												</div>
												<div class="form-group">
													<label>Scroll size </label>
													<input type="number" class="form-control" name="size" [(ngModel)]="filterSettings.Pagination.Limit">
												</div>
												<button type="submit" class="btn btn-default">Filter</button>
											</form>
										</div>
									</div>
								</div>
								<div class="col-md-1 divider" role="separator">
								</div>
								<!--sampling section-->
								<div class="col-md-3">
									<div class="card" style="display: inline;">
										<div class="card-header">
											<span class="h3">
                                                Sample
                                            </span>
										</div>
										<br role="separator" class="divider">
										<div class="card-block">
											<form (submit)="getSample()">
												<div class="form-group">
													<button type="button" class="btn  btn-outline-primary" (click)="sampleTagsIsCollapsed = !sampleTagsIsCollapsed">Select tags</button>
													<br role="separator" class="divider">
													<br/>
													<div class="table-responsive" style="overflow-y: auto; overflow-x: auto; max-height: 300px">
														<table class='table table-striped collapse' [ngbCollapse]="sampleTagsIsCollapsed">
															<thead>
																<th><input type="checkbox" [checked]="getSelectedItemsCount(tagsForSample) == tagsForSample.length" (change)="checkSampleTag($event)"
																		name="checkAll" style="margin: 3px;"></th>
																<th>Name</th>
																<th>Id</th>
															</thead>
															<tbody *vsFor="tagsForSample; tagName:'tr'; scrollParent:'div'; excess: 2; autoresize:true; let _items = vsCollection">
																<tr *ngFor='let tag of _items'>
																	<td><input type="checkbox" [checked]="tag.IsSelected" name="check" (change)="checkSampleTag($event, tag)"></td>
																	<td>{{tag.Name}}</td>
																	<td>{{tag.Id}}</td>
																</tr>
															</tbody>
														</table>
													</div>
													<p>{{ getSelectedItems(tagsForSample) }} item(s) selected
													</p>
												</div>
												<div class="form-group">
													<input type="checkbox" name="isFix" [(ngModel)]="sampleSettings.IsFix">Fix Size
													<br/>
													<div *ngIf="sampleSettings.IsFix">
														<div class="form-group">
															<label>Size </label>
															<input type="number" class="form-control" name="size" [(ngModel)]="sampleSettings.Settings.Size">
														</div>
													</div>
													<div *ngIf="!sampleSettings.IsFix">
														<div class="form-group">
															<label>Percent </label>
															<input type="number" class="form-control" name="percent" [(ngModel)]="sampleSettings.Settings.Percent">
														</div>
													</div>
												</div>
												<button class="btn btn-default" type="submit">Get Sample</button>
											</form>
										</div>
									</div>
								</div>
							</div>
						</div>
						<br/>
						<hr role="separator" class="divider">
						<!--bulk actions-->
						<div class="button-container">
							<button type="button" class="btn btn-default" (click)="deleteConfirm()">Delete</button>
							<button type="button" class="btn btn-default" (click)="copyTo()">Copy To</button>
							<button type="button" class="btn btn-default" (click)="moveTo()">Move To</button>
							<button type="button" class="btn btn-default" (click)="copyAllTo()">Copy To All</button>
							<button type="button" class="btn btn-default" (click)="moveAllTo()">Move To All</button>
							<button type="button" class="btn btn-default" (click)="addTags()">Add Tags</button>
							<button type="button" class="btn btn-default" (click)="removeTags()">Remove Tags</button>
							<button type="button" class="btn btn-default" (click)="clearTagsConfirm()">Clear Tag List</button>
						</div>
						<br role="separator" class="divider">
						<!--Document table-->
						<div class='table-responsive' style="overflow-y: auto; overflow-x: auto; max-height: 400px">
							<p>{{getSelectedItemsCount(documents)}} item(s) selected</p>
							<table class='table table-striped table-interactive' *ngIf='documents && documents.length' infinite-scroll [infiniteScrollDistance]="5" (scrolled)="loadMore()">
								<thead>
									<tr>
										<th></th>
										<th>
											<div>
												<input type="checkbox" [checked]="getSelectedItemsCount(documents) == documents.length" (change)="checkDocument($event)"
													style="margin: 3px;">
											</div>
										</th>
										<th *ngFor='let header of headers'>{{header}}</th>
									</tr>
								</thead>
								<tbody *vsFor="documents; tagName:'tr'; scrollParent:'div'; excess: 2; autoresize:true; let _items = vsCollection; let _startIndex = vsStartIndex">
									<tr *ngFor='let document of _items; let i = index' (click)='select(document)' (dblclick)='openDocument(document)'>
										<td>{{ i + _startIndex + 1}}</td>
										<td><input type="checkbox" [checked]="document.IsSelected" (change)="checkDocument($event, document)"></td>
										<td *ngFor='let header of headers'>{{document.Item[header]}}</td>
										<td>
											<button md-icon-button [md-menu-trigger-for]="menu">
                                                <md-icon>more_vert</md-icon>
                                            </button>
											<md-menu #menu="mdMenu" x-position="before" y-position="above">
												<button md-menu-item (click)="copyTo([document])">CopyTo</button>
												<button md-menu-item (click)="moveTo([document])">MoveTo</button>
												<button md-menu-item (click)="addTags([document])">AddTags</button>
												<button md-menu-item (click)="removeTags([document])">RemoveTags</button>
												<button md-menu-item (click)="clearTagsConfirm([document])">Clear tags</button>
												<button md-menu-item (click)="deleteConfirm([document])">Delete</button>
												<button md-menu-item (click)="editDocument(document)">Edit</button>
												<button md-menu-item (click)="openDocument(document)">Open</button>
												<button md-menu-item (click)="preview(document)">Preview</button>
											</md-menu>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
						<div>
							<button (click)='loadMore()' *ngIf='_scrollId'>Load more</button>
						</div>
						<div>
							<p>{{selectedDocument}}</p>
						</div>
					</template>
				</ngb-tab>
				<ngb-tab title="Tags">
					<template ngbTabContent>
						<br/>
						<div class="row">
							<button type="button" class="btn  btn-outline-primary" (click)="collapsePendingTag()">Add New Tag</button>
						</div>
						<br/>
						<div class="row">
							<div class="col-md-4">
								<form class="form-horizontal collapse" #tagForm="ngForm" [ngbCollapse]="newTagFormIsCollapsed" (ngSubmit)="saveTag()">
									<div class="form-group">
										<label for="id" class="col-sm-2 control-label">Id</label>
										<div class="col-sm-10">
											<input type="text" class="form-control" [(ngModel)]="pendingTag.Tag.Id" name="id" placeholder="Tag Id" />
										</div>
									</div>
									<div class="form-group">
										<label for="name" class="col-sm-2 control-label">Name</label>
										<div class="col-sm-10">
											<input type="text" class="form-control" [(ngModel)]="pendingTag.Tag.Name" name="name" placeholder="Tag Name" />
										</div>
									</div>
									<div class="form-group">
										<label for="parentId" class="col-sm-2 control-label">Parent Id</label>
										<div class="col-sm-10">
											<input type="text" class="form-control" [(ngModel)]="pendingTag.Tag.ParentId" name="parentId" placeholder="Tag ParentId"
											/>
										</div>
									</div>
									<div class="form-group">
										<div class="col-sm-offset-2 col-sm-10">
											<button class="btn" type="submit" [disabled]="!tagForm.valid">Save</button>
										</div>
									</div>
								</form>
								<br/>
							</div>
						</div>
						<br/>

						<hr role="separator" class="divider">
						<!--bulk actions-->
						<div class="button-container">
							<button type="button" class="btn btn-default" (click)="exportWords()">Export Words</button>
							<button type="button" class="btn btn-default" (click)="deleteTagConfirm()">Delete</button>
						</div>
						<br role="separator" class="divider">
						<p>{{getSelectedItemsCount(tags)}} item(s) selected</p>
                        <div class="row">
                            <!--<div class="col-md-2">Filter by:</div>
                            <div class="col-md-4"><input type="text" #idFilter (keyup)="0" /></div>
							<div class="col-md-4"><input type="text" #nameFilter (keyup)="0" /></div>-->
                        </div>
						<div>
							<div class="vs-table-header">
								<table class="table">
									<thead>
										<tr>
											<th class="vs-col-short"></th>
											<th class="vs-col-short">
												<div>
													<input type="checkbox" [checked]="getSelectedItemsCount(tags) == tags.length" (change)="checkTag($event)" style="margin: 3px;">
												</div>
											</th>
											<th class="vs-col-medium">Id</th>
											<th>Name</th>
											<th class="vs-col-medium">ParentId</th>
											<th class="vs-col-large">Path</th>
											<th class="vs-col-short">Leaf</th>
											<th class="vs-col-short">Level</th>
											<th class="vs-col-medium">Document Count</th>
											<th class="vs-col-medium">Word Count</th>
											<th class="vs-col-short"></th>
										</tr>
										<tr>
											<th></th>
											<th></th>
											<th><input type="text" class="form-control input-sm" #idFilter (keyup)="0" placeholder="Id Filter" /></th>
											<th><input type="text" class="form-control input-sm" #nameFilter (keyup)="0" placeholder="Name Filter" /></th>
											<th></th>
											<th></th>
											<th></th>
											<th></th>
											<th></th>
											<th></th>
											<th></th>
										</tr>
									</thead>
								</table>
							</div>
							<div class="vs-table-body">
								<table class='table table-striped tags-table' *ngIf='tags && tags.length'>
									<tbody *vsFor="tags | filter:{Item: {Id:idFilter.value}} | filter:{Item: {Name:nameFilter.value}}; tagName:'tr'; scrollParent:'div'; excess: 2; autoresize:true; let _items = vsCollection; let _startIndex = vsStartIndex">
										<tr *ngFor='let tag of _items; let i = index'>
											<td class="vs-col-short">{{ i + _startIndex + 1}}</td>
											<td class="vs-col-short text-center"><input type="checkbox" [checked]="tag.IsSelected" (change)="checkTag($event, tag)"></td>
											<td class="vs-col-medium">{{tag.Item.Id}}</td>
											<td>{{tag.Item.Name}}</td>
											<td class="vs-col-medium">{{tag.Item.ParentId}}</td>
											<td class="vs-col-large">
												<span *ngFor="let path of tag.Item.Properties.Paths; let fst = first" title="{{path.Id}}">
                                                <i class="fa fa-angle-right" *ngIf="!fst"></i>
                                                {{path.Name}}
                                            </span>
											</td>
											<td class="vs-col-short">{{tag.Item.Properties.IsLeaf}}</td>
											<td class="vs-col-short">{{tag.Item.Properties.Level}}</td>
											<td class="vs-col-medium">{{tag.Item.Properties.DocumentCount}}</td>
											<td class="vs-col-medium">{{tag.Item.Properties.WordCount}}</td>
											<td class="vs-col-short">
												<div ngbDropdown class="dropdown">
													<button md-icon-button [md-menu-trigger-for]="menu">
                                                    <md-icon>more_vert</md-icon>
                                                </button>
													<md-menu #menu="mdMenu" x-position="before">
														<button md-menu-item (click)="exportWords([tag])">Export</button>
														<button md-menu-item (click)="editTag(tag)">Edit</button>
														<button md-menu-item (click)="deleteTagConfirm([tag])">Delete</button>
													</md-menu>
												</div>
											</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
					</template>
				</ngb-tab>
			</ngb-tabset>
		</div>
	</div>
</div>